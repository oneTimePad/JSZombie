function WS4Redis(e,n){"use strict";function o(e){try{console.log("Connecting to "+e+" ..."),f=n.Deferred(),u=new WebSocket(e),u.onopen=r,u.onmessage=i,u.onerror=c,u.onclose=s,d=null}catch(o){f.reject(new Error(o))}}function t(){try{if(m++,m>3)throw new Error("Too many missed heartbeats.");u.send(l.heartbeat_msg)}catch(e){clearInterval(h),h=null,console.warn("Closing connection. Reason: "+e.message),u.close()}}function r(){console.log("Connected!"),g=1,f.resolve(),l.heartbeat_msg&&null===h&&(m=0,h=setInterval(t,5e3)),"function"===n.type(l.connected)&&l.connected()}function s(e){if(console.log("Connection closed!"),!d){var n=a(g);d=setTimeout(function(){g++,o(u.url)},n)}}function c(e){console.error("Websocket connection is broken!"),f.reject(new Error(e))}function i(e){if(l.heartbeat_msg&&e.data===l.heartbeat_msg)m=0;else if("function"===n.type(l.receive_message))return l.receive_message(e.data)}function a(e){var n=1e3*(Math.pow(2,e)-1);return n>3e4&&(n=3e4),Math.random()*n}var l,u,f,d,g=1,h=null,m=0;if(void 0===this)return new WS4Redis(e,n);if(void 0===e.uri)throw new Error("No Websocket URI in options");void 0===n&&(n=jQuery),l=n.extend({heartbeat_msg:null},e),o(l.uri),this.send_message=function(e){u.send(e)}}
